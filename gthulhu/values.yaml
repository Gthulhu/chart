# Default values for gthulhu.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Gthulhu Pod Configuration (Sidecar Pattern)
# The pod contains both the scheduler and API server as sidecars
pod:
  enabled: true

  # Scheduler container configuration
  scheduler:
    image:
      repository: 127.0.0.1:32000/gthulhu
      pullPolicy: Always
      tag: "latest"

    # Resources for the scheduler
    resources:
      limits:
        # cpu: 500m
        memory: 512Mi
      requests:
        # cpu: 100m
        memory: 128Mi

  # API server container configuration (sidecar)
  api:
    enabled: true
    image:
      repository: 127.0.0.1:32000/gthulhu-api
      pullPolicy: Always
      tag: "latest"

    # API server port configuration
    port: 8080

    # Health check configuration
    healthCheck:
      enabled: true
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

    # Resources for the API server
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi

  # Pod-level security context
  securityContext:
    privileged: true
    runAsUser: 0

  # Scheduler container security context
  schedulerSecurityContext:
    capabilities:
      add:
        - SYS_ADMIN
        - SYS_RESOURCE
        - SYS_PTRACE

  # API server container security context
  apiSecurityContext:
    capabilities:
      add:
        - SYS_PTRACE
        - SYS_ADMIN
      drop:
        - NET_RAW

  # Host PID namespace is required for both scheduler and API operations
  hostPID: true

  # Node selector to ensure deployment on nodes with required kernel version
  nodeSelector:
    kubernetes.io/os: linux

  # Tolerations to allow scheduling on any node
  tolerations:
    - operator: Exists

# Service configuration (optional, for external access to API)
service:
  # Set to false for sidecar-only deployment (localhost communication)
  # Set to true if you need external access to the API
  enabled: false
  type: ClusterIP
  port: 80
  targetPort: 8080

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: gthulhu-api.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: gthulhu-api-tls
  #    hosts:
  #      - gthulhu-api.local

# Global configuration
global:
  imagePullSecrets: []
  nameOverride: ""
  fullnameOverride: ""

# Service Account
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod annotations
podAnnotations: {}

# Additional labels for all resources
additionalLabels: {}

# Node selector for all components (can be overridden per component)
nodeSelector: {}

# Tolerations for all components (can be overridden per component)
tolerations: []

# Affinity for all components (can be overridden per component)  
affinity: {}

# Storage configuration for metrics (if needed in future)
persistence:
  enabled: false
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi

# Monitoring and observability
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    labels: {}
    interval: 30s
  path: /metrics

# Horizontal Pod Autoscaler (not recommended for schedulers)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
