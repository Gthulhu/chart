{{- if .Values.scheduler.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gthulhu.fullname" . }}-scheduler-config
  labels:
    {{- include "gthulhu.labels" . | nindent 4 }}
    app.kubernetes.io/component: scheduler
data:
  config.yaml: |
    # Gthulhu Scheduler Configuration
    # This configuration file allows you to adjust scheduler parameters before eBPF program loading
    scheduler:
      # Default time slice in nanoseconds (default: 5000000 = 5ms)
      slice_ns_default: 5000000
      
      # Minimum time slice in nanoseconds (default: 500000 = 0.5ms)
      slice_ns_min: 500000
    api:
      enabled: true
      url: http://127.0.0.1:8080
      interval: 5
      public_key_path: ./api/config/jwt_public_key.pem
    debug: true
    early_processing: false
    builtin_idle: false
{{- end }}
---
{{- if .Values.api.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gthulhu.fullname" . }}-api-config
  labels:
    {{- include "gthulhu.labels" . | nindent 4 }}
    app.kubernetes.io/component: api
data:
  config.json: |
    {
      "server": {
        "port": ":{{ .Values.api.port }}",
        "read_timeout": 15,
        "write_timeout": 15,
        "idle_timeout": 60
      },
      "logging": {
        "level": "info",
        "format": "text"
      },
      "jwt": {
        "private_key_path": "./config/jwt_private_key.key",
        "token_duration": 24
      },
      "strategies": {
        "default": [
          {
            "priority": true,
            "execution_time": 20000,
            "selectors": [
              {
                "key": "app",
                "value": "ueransim-macvlan"
              }
            ],
            "command_regex": "nr-gnb|nr-ue|ping"
          }
        ]
      }
    }
{{- end }}
